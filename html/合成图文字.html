<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0" />
    <meta name="keywords" content="">
    <meta name="description" content="">
    <meta name="format-detection" content="telephone=no" />
    <!-- new end -->
    <style>
    </style>
</head>

<body>

<canvas id="canvas"></canvas>
<img src="../img/dalunfantu.png" id="bg"/>
<!--<div class="mui-content">-->
    <!--<button onclick="mmm('wrap-img','inner-img')" type="button" class="mui-btn mui-btn-blue mui-btn-block">按钮</button>-->

    <!--&lt;!&ndash;-->
        <!--这里要注意 同源策略-->
        <!--可以用自己服务器上的图片-->
        <!--如果遇到问题 请去Stack Overflow解决相关问题-->
     <!--&ndash;&gt;-->
    <!--<img id="inner-img" src="../img/dalunfantu.png"/><img src="../img/back.png" id="wrap-img" height="36" width="434"/>-->
    <!--<canvas id="myCanvas" width="270" height="135" style="border:1px solid #d3d3d3;">-->
    <!--</canvas>-->
    <!--<img src="" alt="" id='new-img'>-->
<!--</div>-->
<script src='https://benjazhu-1.oss-cn-shenzhen.aliyuncs.com/assets/js/jquery2.1.5.min.js'></script>
<script>

    var w = document.documentElement.clientWidth || document.body.clientWidth;
    var h = document.documentElement.clientHeight || document.body.clientHeight;
    h-=70;
    var bg=document.getElementById("bg");
    var imgCode=sessionStorage.getItem("codeImg");
    var canvas="";
    bg.onload = function(){
        canvas=document.getElementById("canvas");
        canvas.width = w;
        canvas.height = h;
        var ctx=canvas.getContext("2d");
        ctx.drawImage(bg, 0, 0, ctx.canvas.width, ctx.canvas.height);
        var img= new Image();
        img.src=imgCode;
        img.οnlοad=function(){
            ctx.drawImage(img, w-h/6.67-28, h-h/6.67-38, h/6.67, h/6.67);
            downloadFile('tox.png', canvas.toDataURL("image/png"));
        };
    };

    function base64Img2Blob(code){
        var parts = code.split(';base64,');
        var contentType = parts[0].split(':')[1];
        var raw = window.atob(parts[1]);
        var rawLength = raw.length;
        var uInt8Array = new Uint8Array(rawLength);
        for (var i = 0; i < rawLength; ++i) {
            uInt8Array[i] = raw.charCodeAt(i);
        }
        return new Blob([uInt8Array], {type: contentType});
    }
    function downloadFile(fileName, content){
        var aLink = document.createElement('a');
        aLink.className="button";
        aLink.innerHTML="保存图片";
        var blob = base64Img2Blob(content);
        aLink.download = fileName;
        aLink.href = URL.createObjectURL(blob);
        document.body.appendChild(aLink);
    }

</script>
<!--<script>-->
    <!--function mmm(wrap_img_id, inner_img_id) {-->
        <!--console.log("mmm");-->
        <!--//两张图-->
        <!--var img = document.getElementById(wrap_img_id);-->
        <!--var canvas = document.getElementById("myCanvas");-->
        <!--canvas.width = img.width;-->
        <!--canvas.height = img.height;-->
        <!--var ctx = canvas.getContext("2d");-->
        <!--ctx.drawImage(img, 0, 0, img.width, img.height);-->


        <!--var img2 = document.getElementById(inner_img_id);-->

        <!--var scale = 5-->

        <!--ctx.drawImage(img2, 0, 0, img2.width, img2.height, img.width - img2.width / scale, 0, img2.width / scale, img2.height / scale);-->



        <!--ctx.font = "20px Georgia";-->
        <!--ctx.fillText("Hello World!", 10, 50);-->

        <!--ctx.font = "30px Verdana";-->
        <!--e.preventDefault();     //阻止默认事件-->
        <!--e.stopPropagation();    //阻止冒泡事件-->
        <!--srccc = canvas.toDataURL("image/jpeg", 0.8);-->
        <!--console.log(srccc);-->
        <!--$('#new-img').attr('src', srccc);-->
    <!--}-->
<!--</script>-->
</body>

</html>


